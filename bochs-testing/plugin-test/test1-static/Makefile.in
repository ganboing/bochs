top_builddir = ..
srcdir = @srcdir@
VPATH = @srcdir@

CXX=@CXX@
CXXFLAGS=@CXXFLAGS@
LDFLAGS=@LDFLAGS@ @LT_LDFLAGS@
LIBTOOL=@LIBTOOL@

all: uselib

uselib: uselib.cc libmodule1.la
	$(LIBTOOL) $(CXX) $(LDFLAGS) -o uselib $(srcdir)/uselib.cc libmodule1.la

libmodule1.la: module1.lo
	$(LIBTOOL) $(CXX) $(LDFLAGS) -o libmodule1.la module1.lo

%.lo: %.cc
	$(LIBTOOL) $(CXX) $(CXXFLAGS) -c $<

test:
	@echo "*** Running test in `pwd`"
	-./uselib
	@echo "*** Test done in `pwd`"

clean: 
	-$(LIBTOOL) rm libmodule1.la module1.lo uselib.exe uselib
	rm -rf .libs
